# 기초 연산 타임어택 게임

**어려울수록 점수가 높아져요!**

초등학생을 위한 덧셈 연산 속도 향상 웹 게임

## 📋 프로젝트 개요

- **목적**: 초등학생의 기초 연산(덧셈) 속도 향상을 위한 타임어택 게임
- **대상**: 초등학교 1~5학년
- **기술 스택**: HTML, CSS (Tailwind), JavaScript, Firebase (Firestore)
- **제작자**: 둥둥이들아빠 💜

## 📝 작업 일지

### 2024년 작업 기록

#### 초기 개발 (v1.0)
- 단일 HTML 파일로 덧셈 타임어택 게임 개발
- 3단계 난이도 구성 (한 자리, 두 자리+한 자리, 두 자리+두 자리)
- 60초 제한 시간
- 정답 시 자동 다음 문제 전환
- 오답 시 화면 흔들림 효과
- 콤보 시스템 (5, 10, 15, 20 콤보 시 특별 연출)
- 꽃가루 효과 (canvas-confetti)
- LocalStorage를 활용한 최고 기록 저장

#### v1.1 - 일본어 제거 및 한국어 힙한 문구 추가
- 일본어 칭찬 문구 제거
- 한국어 힙한 문구로 교체: "완벽해!", "연산 천재!", "기초가 튼튼해지고 있어!", "찢었다..✨" 등
- 초등학교 5학년 여학생 사용자에 맞춘 감성 칭찬 문구 적용

#### v1.2 - 초1 수준 기초 연산 게임으로 전환
- 난이도 재구성:
  - Level 1: 10 이하의 수 더하기
  - Level 2: 10 이하의 수 빼기 (음수 없음)
  - Level 3: 합이 20 이하인 두 수의 더하기
- 라벤더 & 핑크 테마 적용
- 아빠의 응원 문구 추가: "오늘도 기초부터 차근차근! 💪"

#### v1.3 - 격려 멘트 제거 및 콤보 시스템 개선
- 매번 나오는 격려 멘트 제거
- 콤보 시스템 개선: 5, 10, 15, 20 등 특정 콤보에서만 화려한 연출
- 일반 콤보는 작게 표시

#### v1.4 - 오답 콤보 시스템 추가
- 오답 시 마이너스 점수 적용
- 오답 콤보 시스템 추가
- 정답/오답 콤보 독립 관리

#### v1.5 - 유저네임 및 랭킹 시스템 추가
- 게임 시작 전 유저네임 입력 기능
- LocalStorage에 유저네임 저장 (기본값: "꽁꽁이")
- 역대 랭킹 Top 10 표시
- 로비 화면에서 유저네임 수정 가능

#### v1.6 - 모바일 반응형 개선
- 다양한 브레이크포인트 적용 (480px, 640px, 768px, 1024px)
- 모바일에서 폰트 크기 및 버튼 크기 최적화
- 터치 최적화 (tap highlight 제거, 버튼 크기 확대)
- 스크롤 가능한 랭킹 리스트

#### v1.7 - 정답률 표시 및 상황별 멘트 개선
- 정답률 계산 및 표시 추가
- 게임 종료 후 상황에 맞는 멘트 표시:
  - 개인 최고 기록 경신 + 1등: "개인 최고 기록 경신 + 1등 달성!"
  - 개인 최고 기록 경신: "개인 최고 기록 경신!"
  - 1등: "1등 달성!"
  - 2-3등: "2등/3등 달성!"
  - 4-10등: "X등!"
  - 10등 밖: "랭킹: X등"

#### v1.8 - 점수 변화 실시간 표시
- 정답/오답 시 점수 변화를 오른쪽 위에 실시간 표시
- 폭죽처럼 위로 올라가며 사라지는 애니메이션
- 정답/오답 색상 구분

#### v1.9 - 오답 처리 개선
- 오답 입력 시 정답을 빨간 글씨로 표시
- 오답 후 자동으로 다음 문제로 진행 (대기시간 0.375초)
- 오답 시 흔들림 효과 시간 단축 (0.5초 → 0.125초)
- 숫자만 입력 가능하도록 제한 (일반 숫자키 + 넘버패드)
- 두 자리 수 입력 시 첫 번째 자리만 읽히는 문제 해결

#### v2.0 - 레벨 재구성 (더하기 전용)
- 빼기 레벨 제거, 더하기만 유지
- 레벨별 점수 배율 적용 (어려울수록 높은 점수)
  - Level 1: 한 자리 + 한 자리 (합 9 이하)
  - Level 2: 한 자리 + 한 자리 (합 18 이하)
  - Level 3: 20 이하 랜덤 더하기
  - Level 4: 두 자리 + 두 자리 더하기

#### v2.1 - 코드 모듈화
- `game-logic.js`: 레벨별 문제 생성 및 정답 체크 로직 분리
- `scoring.js`: 점수 계산, 콤보, 배율 관리 분리
- `index.html`: UI 컨트롤만 담당
- 관심사 분리로 유지보수성 향상

#### v2.2 - Firebase 전역 랭킹 시스템 추가
- Firebase Firestore를 활용한 전역 랭킹 시스템
- 여러 사용자가 동시 접속해도 같은 랭킹 공유
- Firebase 설정이 없으면 LocalStorage로 자동 전환 (Fallback)
- 실시간 랭킹 동기화

#### v2.3 - 레벨 설명 개선 및 UI 문구 변경
- 레벨 설명을 더 명확하게 변경:
  - Level 1: 올림이 없는 한자리 더하기
  - Level 2: 올림이 있는 한자리 더하기
  - Level 3: 20 이하 더하기
  - Level 4: 두자리 두자리 더하기
- "오늘도 기초부터 차근차근!" → "어려울수록 점수가 높아져요!" 문구 변경
- 스코어링 관련 구체적인 점수 배율 텍스트 제거 (UI에서 숨김)
- game-logic.js의 Level 2 로직 수정: 올림이 있는 경우만 생성 (합 10 이상 18 이하)

#### v2.4 - 유저네임 화면에 랭킹 표시 추가
- 유저네임 입력 화면 하단에 "역대 랭킹 Top 10" 섹션 추가
- 페이지 로드 시 자동으로 랭킹 불러오기 및 표시
- 게임 시작 전에도 현재 랭킹 확인 가능

#### v2.5 - 랭킹 표시 버그 수정
- 랭킹 -1등 표시 문제 해결: findCurrentRank 함수 개선
  - 기록을 찾지 못할 경우 점수 기준으로 순위 계산
  - -1등 또는 10등 밖일 때는 랭킹 정보 표시 안 함
- 랭킹 추가 후 전체 랭킹을 다시 가져와 최신 상태 반영
- 랭킹 표시 로직 개선으로 정확한 순위 표시

#### v2.6 - Firebase 랭킹 시스템 개선 및 버그 수정
- Firebase 쿼리 수정: orderBy 중복 사용 문제 해결
  - Firebase는 하나의 orderBy만 지원하므로 점수로만 정렬 후 클라이언트에서 correctCount로 추가 정렬
  - limit을 50으로 늘려 충분히 가져온 후 Top 10만 반환
- 랭킹 갱신 로직 개선:
  - 랭킹 추가 후 800ms 지연을 두고 다시 가져와 Firebase 동기화 보장
  - addToRankingFirebase 내부에서도 300ms 지연 추가
- findCurrentRank 함수 개선:
  - 기록을 찾지 못했을 때도 점수 기준으로 순위 계산하여 1등 달성 시 제대로 표시
  - Top 10 안에 들어가는 경우 정확한 순위 반환
- 랭킹 표시 보장: displayRanking에서 최대 10개까지 표시하도록 slice(0, 10) 적용
- 디버깅 로그 추가: Firebase 연결 상태 및 랭킹 동작 확인용 콘솔 로그 추가

#### v2.7 - 결과 화면 레이아웃 개선
- 랭킹 리스트 스크롤바 제거: max-h와 overflow-y-auto 제거하여 모든 랭킹 항목 표시
- "다시 도전하기" 버튼 위치 변경: "역대 랭킹 Top 10" 제목 바로 위로 이동
- 레이아웃 순서: 개인 최고 기록 → 다시 도전하기 버튼 → 역대 랭킹

#### v2.8 - 초기 화면 랭킹 표시 개선
- 초기 화면(유저네임 입력 화면) 랭킹 스크롤바 제거: max-h와 overflow-y-auto 제거
- displayUsernameRanking 함수에서 Top 10까지만 명시적으로 표시하도록 slice(0, 10) 추가
- 모든 랭킹 항목이 스크롤 없이 표시되도록 개선

#### v2.9 - 앱 제목 변경
- "기초 연산 타임어택" → "머리가 좋아지는 산수산수"로 제목 변경
- title 태그, 유저네임 화면, 로비 화면의 모든 제목 일괄 변경

#### v2.10 - UI 개선 및 모바일 최적화
- 제목에서 🔢 이모지 제거
- "머리가 좋아지는 산수산수" → "머리가 좋아지는 60초!"로 변경
- 모바일에서 점수 추가 효과 글자 크기 2배로 증가 (1.2rem → 2.4rem)
- 모바일에서 타이머 표시 크기 증가 (text-2xl → text-3xl, time-value 2.5rem)
- 초기 화면 이름 입력 칸에 흔들림 효과 추가 (페이지 로드 시 1회)

#### v2.11 - 레벨별 점수 배율 조정
- Level 2: 1.2배 → 1.5배
- Level 3: 1.4배 → 2.0배
- Level 4: 2.0배 → 4.0배
- 어려운 레벨일수록 더 높은 점수를 얻을 수 있도록 조정

#### v2.12 - 빼기 레벨 추가 및 레벨 구조 확장
- 레벨 구조를 4단계에서 8단계로 확장
- 더하기와 빼기를 교차 배치:
  - Level 1: 올림이 없는 한자리 더하기 (배율 1.0)
  - Level 2: 한자리 빼기 (배율 2.0)
  - Level 3: 올림이 있는 한자리 더하기 (배율 1.5)
  - Level 4: 두자리에서 한자리 빼기 (배율 2.5)
  - Level 5: 20 이하 더하기 (배율 2.0)
  - Level 6: 20 이하 빼기 (배율 3.0)
  - Level 7: 두자리 두자리 더하기 (배율 4.0)
  - Level 8: 두자리에서 두자리 빼기 (배율 6.0)
- 빼기 레벨의 점수 배율은 해당 더하기 레벨보다 높게 설정 (1~2점 추가)
- 빼기 문제에서 음수 결과가 나오지 않도록 로직 보장

#### v2.13 - 레벨 버튼 UI 개선
- 레벨 버튼에서 아이콘 제거 (✨, ➖, 🔥, 💪, 🎯 등)
- 레벨 텍스트를 왼쪽 정렬로 변경 (text-left, pl-4 sm:pl-6 추가)
- 더 깔끔하고 일관된 디자인

#### v2.14 - 이름 저장/불러오기 버그 수정
- saveUsername() 함수에서 로비 화면의 이름 입력 필드에 값을 설정하도록 수정
- 초기 화면에서 입력한 이름이 로비 화면으로 제대로 전달되도록 개선
- 게임 시작 시 입력한 이름이 랭킹에 정확히 저장되도록 보장

#### v2.15 - 개인 최고 점수 표시 개선
- LocalStorage 대신 Firebase 랭킹에서 현재 사용자 이름으로 최고 점수 검색
- 결과 화면에서 개인 최고 점수만 표시 (최고 개수 제거)
- getAllRankingForUser() 함수 추가: 특정 사용자의 모든 기록을 가져와서 최고 점수 계산
- 랭킹에 추가하기 전에 현재 사용자의 최고 점수를 찾아서 정확한 개인 최고 점수 표시
- 최고 기록 경신 시 현재 점수를 최고 점수로 표시

#### v2.16 - 곱셈 레벨 6개 추가 (총 14레벨)
- Level 9: 구구단 (곱해서 20 이하) - 배율 7.0
- Level 10: 구구단 (곱해서 20 초과) - 배율 8.0
- Level 11: 2의 거듭제곱 (1, 2, 4, 8, 16, 32, 64, 128, 256, 512, 1024) - 배율 9.0
- Level 12: 3의 거듭제곱 (1, 3, 9, 27, 81, 243) - 배율 9.0
- Level 13: 두자리수 × 한자리수 (10~19 × 1~9) - 배율 10.0
- Level 14: 제곱수 외우기 (1² ~ 19²) - 배율 11.0
- 곱셈 연산자(×), 거듭제곱(^), 제곱(²) 표시 로직 추가
- 문제 표시 형식 개선 (거듭제곱은 2^5, 제곱수는 5² 형식으로 표시)

#### v2.17 - 거듭제곱 레벨 형식 변경
- Level 11: 3의 거듭제곱을 곱셈 형식으로 변경 (예: 3 × 9, 9 × 27) - 배율 8.0으로 조정
- Level 12: 2의 거듭제곱을 곱셈 형식으로 변경 (예: 16 × 8, 32 × 16) - 배율 9.0 유지
- 거듭제곱 표기(^) 대신 곱셈(×) 형식으로 문제 출제하여 암산 연습 효과 향상

#### v2.18 - 랭킹 표시 개선 (서버 전체 / 개인 랭킹 분리)
- 초기 화면과 결과 화면에 랭킹을 두 줄로 분리하여 표시
- 왼쪽: 세계 Top10 (모든 사용자 중 상위 10명)
- 오른쪽: 개인 기록 (현재 사용자의 기록 중 상위 10개)
- 그리드 레이아웃으로 모바일에서는 세로로, 데스크톱에서는 가로로 표시
- 개인 랭킹은 점수 순으로 정렬하여 사용자의 성장 추이를 한눈에 확인 가능
- 제목 간결화: "서버 전체 랭킹 Top 10" → "세계 Top10", "개인 랭킹 Top 10" → "개인 기록"

## 🎮 게임 규칙

### 기본 규칙
- 제한 시간: 60초
- 정답 입력 시 자동으로 다음 문제로 전환
- 오답 입력 시 정답 표시 후 자동으로 다음 문제로 전환

### 콤보 시스템
- 연속 정답 시 콤보 증가
- 5, 10, 15, 20, 30... 콤보 시 특별 연출
- 오답 시 콤보 리셋

## 📁 파일 구조

```
math-plus/
├── index.html          # 메인 HTML 파일 (UI 컨트롤)
├── game-logic.js       # 게임 로직 모듈 (문제 생성, 정답 체크)
├── scoring.js          # 스코어링 모듈 (점수 계산, 콤보 관리)
└── README.md           # 프로젝트 문서
```

## 🚀 사용 방법

1. `index.html` 파일을 브라우저에서 열기
2. 유저네임 입력 (기본값: "꽁꽁이")
3. 레벨 선택
4. 60초 동안 최대한 많은 문제 풀기

## 🔧 Firebase 설정 (선택사항)

전역 랭킹을 사용하려면 Firebase 설정이 필요합니다:

1. Firebase Console (https://console.firebase.google.com) 접속
2. 새 프로젝트 생성
3. Firestore Database 생성 (테스트 모드)
4. 웹 앱 추가 → 설정 복사
5. `index.html`의 `firebaseConfig`에 설정 입력

Firebase 설정이 없어도 LocalStorage를 사용하여 개인 랭킹은 작동합니다.

## 🎨 디자인

- 테마: 라벤더 & 핑크 파스텔 톤
- 폰트: Jua (Google Fonts)
- 반응형: 모바일, 태블릿, 데스크톱 지원
- 애니메이션: Tailwind CSS + 커스텀 CSS

## 📊 기능 목록

- ✅ 레벨별 난이도 선택 (14단계: 덧셈/뺄셈 8단계 + 곱셈 6단계)
- ✅ 실시간 점수 표시
- ✅ 콤보 시스템
- ✅ 정답률 계산
- ✅ 랭킹 시스템 (LocalStorage + Firebase)
- ✅ 유저네임 관리
- ✅ 모바일 최적화
- ✅ 점수 변화 실시간 표시
- ✅ 오답 시 정답 표시 및 자동 진행

## 🔮 향후 계획

- [ ] 레벨별 통계 기능
- [ ] 일일 도전 모드
- [ ] 친구와 대전 모드
- [ ] 성취 시스템
- [ ] 더 많은 레벨 추가

## 📄 라이선스

개인 프로젝트 - 자유롭게 사용 가능

## 👨‍💻 제작자

**둥둥이들아빠** 💜

---

*마지막 업데이트: 2024년*
